<% provide(:title, "AdminCalendar") %>

<div class="container">
  <h1 class="top">業務設定</h1>
  <h2 class="my-class">業務の追加or削除</h2>
  <%= form_with(model: @task, local: true, id: 'new_task_form') do |f| %>
    <%= f.label :name, "(8文字まで)" %>
    <%= f.text_field :name, class: 'form-control' %>
    <%= f.submit "業務を追加", class: "btn btn-primary" %>
  <% end %>
  <ul>
    <% if @tasks.empty? %>
      <li>業務が設定されていません</li>
    <% end %>
    <% @tasks.each do |task| %>
      <li>
        <%= task.name %>
        <a data-confirm="削除しますか？" rel="nofollow" data-method="delete" href="/tasks/<%= task.id %>" class="delete-btn" data-url="/tasks/<%= task.id %>" data-redirect="/tasks">削除</a>
      </li>
    <% end %>
  </ul>

  <!-- 希望時間帯編集ボタンと一覧表示 -->
  <h2 class="my-class">シフト希望時間帯の編集</h2>
  <ul>
    <% @time_slots.each do |time_slot| %>
      <li><%= "#{time_slot.name} (#{time_slot.start_time.strftime('%H:%M')} ～ #{time_slot.end_time.strftime('%H:%M')})" %></li>
    <% end %>
  </ul>
  <button class="btn btn-secondary"><a href="time_slots/edit">編集</a></button>

  <!-- 希望シフト編集ボタンと一覧表示 -->
  <h2 class="my-class">シフト希望度の編集</h2>
  <ul>
    <% @preference_levels.each do |preference_level| %>
      <div class="shift-preference preference-level-<%= preference_level.id %>">
        <li>
          <%= preference_level.name %>
        </li>
      </div>
    <% end %>
  </ul>
  <button class="btn btn-secondary"><a href="preference_levels/edit">編集</a></button>

</div>





<script>
  // Delete handler for task
  document.querySelectorAll('.delete-btn').forEach(function(btn) {
    btn.addEventListener('click', function(e) {
      e.preventDefault();
      if (confirm('本当に削除しますか？')) {
        fetch(e.target.dataset.url, {
          method: 'DELETE',
          headers: {
            'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
          }
        })
        .then(function() {
          window.location = e.target.dataset.redirect;
        });
      }
    });
  });
</script>



